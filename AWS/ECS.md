## ECS ( Elastic Container Service )

### 요약

#### 키워드

- 매니지드 컨테이너 오케스트레이션 서비스
- 컨테이너 가상화 기반
- 도커 지원
- 클러스터
- 컨테이너 인스턴스
- 태스크 디피니션
- 태스크
- 서비스
    - 태스크 디피니션으로 직접 태스크를 실행하는 방식
    - 서비스를 정의하는 방법. 서비스와 태스크 디피니션이 1:1로 매칭 됨
        - 리플리카 타입
        - 데몬 타입

#### 내용 (아래 개념도가 중요함)

![Untitled](https://user-images.githubusercontent.com/91730236/191997766-dfc38ab3-d091-4583-b61a-005156d79410.png)


#### 1. 클러스터

- ECS의 가장 기본적인 단위
- 클러스터는 도커 컨테이너를 실행 할 수 있는 가상의 공간 → 쿠버네티스에서 Node의 개념과 매칭됨

#### 2. 컨테이너 인스턴스

- EC2에 ecs-client라는 서비스를 실행해서 특정 클러스터에 연결이 가능함
- 클러스터에 연결된 EC2 인스턴스를 컨테이너 인스턴스라고 함
- esc-client는 컨테이너 인스턴스의 자원을 모니터링 및 관찰하고 클러스터로 요청된 컨테이너들을 적절하게 실행하는 역할

<aside>
☝ 클러스터는 논리적 단위이다. 안에서 실질적으로 리소스가 할당되어 돌아가는 개념은 EC2 인스턴스인 컨테이너 인스턴스이다.

클러스터는 여러 EC2 인스턴스를 거쳐서 범위 설정이 가능하고,
각각의 클러스터 단위에서 관리되는 클러스터 인스턴스를 관리하는 도구가 ecs-client다.

</aside>

![Untitled 1](https://user-images.githubusercontent.com/91730236/191998111-422264f7-4091-433b-a69c-156220905871.png)

#### 3. 띄워진 인스턴스에 application을 실행하는 방법 → Task

- 태스크는 컨테이너를 실행하는 하나의 최소 단위.
- 태스크는 하나 이상의 컨테이너로 구성 됨
- 일반적으로 하나의 필수 컨테이너만으로 구성 됨
- 필수 컨테이너 + n개의 추가적인 컨테이너 조합 가능
- 같은 태스크로 실행되는 컨테이너들은 모두 같은 컨테이너 인스턴에서 실행되는 것이 보장됨

#### 4. Task Definition이 필요하다. → 쿠버네티스에서 yaml 같은거네

- 태스크를 실행 할 때 컨테이너 네트워크 모드, 태스크 역할, 도커 이미지, 실행 명령어, CPU제한, 메모리 제한 등 가수의 설정이 필요하다
- 이런 것들을 하나의 단위로 정의해두고 사용하는 것이 태스크 디피니션
- 이렇게 실행되는 태스크는 실행 이후에 관리 되지 않는다.

#### 5. 서비스

- 서비스는 하나의 태스크 디피니션과 연결
- 두가지 종류가 있다.
    - 데몬 타입
    - 레플리카 타입

![Untitled 2](https://user-images.githubusercontent.com/91730236/191998071-9ace236e-bb5b-4917-b551-b70ac082997d.png)

- 여러 서비스에 분산하는 방식도 instance단위로 균등하게 실행할 것인지 subnet의 네트워크 기반해서 배포할 것인지 확인이 필요함.

#### 6. ECR ( 엘라스틱 컨테이너 레지스트리 ) → 프라이빗 도커 레지스트리 서비스를 제공하고 있다.

- 이미지 저장소

#### 7. 사용 기능

- 컨테이너 자동 배포(기본)
- 컨테이너 자동 배치 및 복제
- 컨테이너 그룹에 대한 로드 밸런싱
- 컨테이너 장애 복구
- 클러스터 외부에 서비스 노출
- 컨테이너 추가 또는 제거로 확장 및 축소
- 컨테이너 서비스 간의 인터페이스를 통한 연결 및 네트워크 포트 노출 제어


<br/>
<br/>

#### 8. 공식문서

| 제목 | 링크 | 요약 |
| --- | --- | --- |
| ECS 메인 페이지 | [링크](https://aws.amazon.com/ko/ecs/) | ECS 메인 페이지입니다. |
| 태스트 정의 파라미터 | [링크](https://docs.aws.amazon.com/ko_kr/AmazonECS/latest/developerguide/task_definition_parameters.html#container_definition_dependson) | 태스크를 정의와 관련된 개발자 문서입니다. |
| 네트워크 설정 관련 | [링크](https://docs.aws.amazon.com/ko_kr/AmazonECS/latest/bestpracticesguide/networking-networkmode.html#networking-networkmode-bridge) | 네트워크 설정에 대한 내요 제공 |
